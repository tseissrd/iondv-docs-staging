.. role:: raw-html-m2r(raw)
   :format: html


Предыдущая страница: `Вычисляемые атрибуты </docs/ru/2_system_description/metadata_structure/meta_class/atr_formula.md#вычисляемые-атрибуты-без-кеширования>`_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Переменные
==========

Значение атрибутов
------------------

``$`` - применяется вместе с системным наименованием атрибута и возвращает значение указанного атрибута, т.е. если указать ``$name`` при формировании какого-либо условия для действий над значениями атрибутов, то значение атрибута ``name`` и будет источником для заданного условия.

*пример применения для вычислямого атрибута*

.. code-block::

   {
     "formula": {
           "count": [
               "$projects"
           ]
         }
      ...
   }

В текущем классе есть атрибут типа "Коллекция"  ``projects`` и, согласно формуле, необходимо посчитать колличество значений данного атрибута.

Результат: количество объектов атрибута ``projects``

Текущая дата/время, дата
------------------------

``$$now`` - возвращает текущую дату и время

*пример применения для фильтра допустимых значений*
в навигации:

.. code-block:: json

   {
         "property": "dateEnd",
         "operation": 5,
         "value": [
           "$$now"
         ],
         "nestedConditions": []
       }

"dateEnd" меньше текущей даты/времени

*пример применения для вывода значения по умолчанию*
в мете класса:

.. code-block:: json

   ...
   "defaultValue": "$$now",
   ...

``$$today`` - возвращает начало суток текущей даты 
*принцип тот же, только дата без времени*

Синтаксис форматирования дат в формате momentjs
-----------------------------------------------

.. code-block::

   'DD.MM.YYYY'

.. code-block::

   NB. В драйвере к монгодб поддерживаются только основные возможности формата momentjs

Текущий пользователь
--------------------

``$$uid`` - возвращает текущего пользователя

*пример применения для фильтра допустимых значений в коллекции:*

.. code-block:: json

   {
   "property": "collectionAttr",
   "operation": 10,
   "nestedConditions": [
      {
         "property": "user",
         "operation": 0,
         "value": ["$$uid"]
      }
   ] 
   }

по ссылке атрибута типа "коллекция" отображать только те объекты, у которых значение атрибута "user" совпадает со значением текущего пользователя.

----

`Licence </LICENSE>`_ &ensp;  `Contact us <https://iondv.com/portal/contacts>`_ &ensp;  `English </docs/en/2_system_description/metadata_structure/meta_variables.md>`_ &ensp;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


.. raw:: html

   <div><img src="https://mc.iondv.com/watch/local/docs/framework" style="position:absolute; left:-9999px;" height=1 width=1 alt="iondv metrics"></div>


----

Copyright (c) 2018 **LLC "ION DV"**.\ :raw-html-m2r:`<br>`
All rights reserved. 
